# Program, Process, Thread

### 1) Program

 `Program`은 실행 파일입니다. `파일 시스템에 존재하는 실행파일`이 프로그램입니다.

<br>

### 2) Process

 `Process` 는 실행 중인 `Program`입니다. `Program`을 실행하게 되면 메모리에 올라와 CPU를 차지하는데, 이런 실행되고 있는 프로그램의 인스턴스를 `Process`라고 합니다. 

- 각 프로세스는 별도의 주소 공간에서 실행되며, 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근할 수 없다.

![process](https://user-images.githubusercontent.com/59816811/136655490-751d815c-ee45-47aa-a4b4-943b099c83cf.png)

 `Program`은 운영체제로부터 메모리를 할당받는데 크게 4가지 영역으로 나뉩니다. `Code`, `Data`, `Stack`, `Heap` 영역으로 나뉩니다.

- Code 영역

   메모리의 코드 영역은 실행할 프로그램의 코드가 저장되는 영역입니다. CPU는 코드 영역에 저장된 명령어를 하나씩 가져가서 처리합니다.

- Data 영역

   메모리의 데이터 영역은 프로그램의 전역 변수와 정적 변수가 저장되는 영역입니다. 데이터 영역은 프로그램의 시작과 함께 할당되며, 프로그램이 종료되면 소멸합니다. 

- Stack 영역

   메모리의 스택 영역은 함수의 호출과 관계되는 지역 변수와 매개변수가 저장되는 영역입니다. 스택 영역은 함수의 호출과 함께 할당되며, 함수의 호출이 완료되면 소멸합니다.

   스택 영역은 메모리의 높은 주소에서 낮은 주소의 방향으로 할당되고, 해당 영역의 메모리를 초과하게 되면 `Stack Overflow`가 발생합니다.

- Heap 영역

   메모리의 힙 영역은 사용자가 직접 관리하는 메모리영역입니다. 힙 영역은 사용자에 의해 메모리 공간이 동적으로 할당되고 해제됩니다. `Java`에서는 `JVM`의 `GC`가 힙 영역을 관리해줍니다.

   힙 영역은 메모리의 낮은 주소에서 높은 주소의 방향으로 할당되고, 해당 영역의 메모리를 초과하게 되면 `Heap Overflow`가 발생합니다. 

<br>

### 3) Thread

 `Thread` 는 프로세스 내에서 자원을 이용하는 실행의 단위입니다. 같은 일을 처리하기 위해 동일한 프로그램을 여러 개의 프로세스로 만들게 되면, 그만큼 메모리를 차지하게 되고  `PCB` 도 각각 만들어야되고 프로세스간 통신을 위해 코스트가 추가로 듭니다.

 이 문제를 해결하기 위해 하나의 프로세스 안에 공유할 수 있는 자원은 최대한 공유해가며 일을 처리하는 `Thread` 개념이 등장했습니다.

 `Thread`는 `Process` 안에서 일을 처리하는 실행 단위로 `Stack` 영역만 `Thread`마다 구분하고 나머지 영역은 공유해서 사용합니다. `Thread` 를 교체하는 비용은 `Process`를 교체하는 오버헤드보다 작고 메모리를 공유해 사용하므로 메모리도 덜 사용한다는 많은 장점이 있습니다.

- 스레드는 하나의 프로세스 내에서 동작되는 여러 실행의 흐름

<br>

### 4) Multi Process

<img width="693" alt="스크린샷 2021-03-07 오후 3 15 46" src="https://user-images.githubusercontent.com/59816811/136658176-e52f44af-1f5c-49f3-8e24-b80d96b506e8.png">

 두개 이상 다수의 프로세서(`CPU`)가 협력적으로 하나 이상의 작업(`Task`)을 동시에 처리하는 것이다(병렬처리) . 각 프로세스 간 메모리 구분이 필요하거나 독립된 주소 공간을 가져야 할 경우 사용한다.

#### 장점

- 독립된 구조로 안전성이 높은 장점이 있다.
- 프로세스 중 하나에 문제가 생겨도 다른 프로세스에 영향을 주지 않아, 작업속도가 느려지는 손해정도는 생기지만 정지되거나 하는 문제는 발생하지 않는다.
- 여러개의 프로세스가 처리되어야 할 때 동일한 데이터를 사용하고, 이러한 데이터를 하나의 디스크에 두고 모든 프로세서(`CPU`)가 이를 공유하면 비용적으로 저렴하다.

#### 문제점

- 독립된 메모리 영역이기 때문에 작업량이 많을수록( `Context Switching`이 자주 일어나서 주소 공간의 공유가 잦을 경우) 오버헤드가 발생하여 성능저하가 발생 할 수 있다.
- `Context Switching` 과정에서 캐시 메모리 초기화 등 무거운 작업이 진행되고 시간이 소모되는 등 오버헤드가 발생한다.

#### Context Switching

- `CPU`는 한번에 하나의 프로세스만 실행 가능하다.
- `CPU`에서 여러 프로세스를 돌아가면서 작업을 처리하는 데 이 과정을 `Context Switching`라 한다.
- 구체적으로, 동작 중인 프로세스가 대기를 하면서 해당 프로세스의 상태(`Context`)를 보관하고, 대기하고 있던 다음 순서의 프로세스가 동작하면서 이전에 보관했던 프로세스의 상태를 복구하는 작업을 말한다.

<br>

### 5) Multi Thread

 <img width="689" alt="스크린샷 2021-03-07 오후 3 49 40" src="https://user-images.githubusercontent.com/59816811/136658178-6e676472-acf2-44b3-addf-b1afeaf22386.png">

하나의 응용 프로그램에서 여러 스레드를 구성해 **각 스레드가 하나의 작업을 처리**하는 것입니다.

#### 장점

- 메모리 공간, 시스템 자원의 효율성 증가
- Data, Heap 영역을 이용해 데이터를 주고 받으므로 스레드간 통신이 간단함
- context switching시 비용이 적음 (교환해야 할게 적으니까!) -> 시스템 처리량 향상, 프로그램 응답 시간 단축됨

#### 단점

- 서로 다른 스레드가 Stack을 제외한 메모리 공간을 공유하기 때문에 동기화 문제가 발생할 수 있음
- 하나의 스레드에 문제가 생기면 전체 프로세스가 영향을 받음
- 주의 깊은 설계가 필요하며 디버깅이 까다로움 ( 프로그래머의 역량 ) 

<br>

### Q. 멀티 프로세스로 할 수 있는 작업들을 굳이 하나의 프로세스에서 스레드로 나눠가며 할까?

- 운영체제가 시스템 자원을 효율적으로 관리하기 위해 스레드를 사용한다.
- 멀티 프로세스로 실행되는 작업을 멀티 스레드로 실행할 경우, 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어들어 자원을 효율적으로 관리할 수 있다.
- 또한, 프로세스 간의 통신보다 스레드 간의 통신 비용이 적으므로 작업들 간 통신의 부담이 줄어든다. (처리비용 감소. 프로세스는 독립구조이기 때문)

<br>

### Q. 무조건 멀티 스레드가 좋을까?

- 스레드를 활용하면 자원의 효율성이 증가하기도 하지만, 스레드 간의 자원 공유는 전역 변수를 이용하므로 동기화 문제가 발생 할 수 있으므로 프로그래머의 주의가 필요하다.